<html>
<head>
	<title>Javascript Box - OOP demo</title>
	<script src="jquery-2.1.4.min.js"></script>
	<script src="asteroid.js"></script>
	<script src="ship.js"></script>
</head>
<body>
	<style>
		html, body {
			margin:0; padding:0; overflow:hidden
		}
		svg {
			position:fixed; top:0; left:0; height:100%; width:100%
		}
	</style>
	<svg id="svg" xmlns="http://www.w3.org/2000/svg"></svg>

	<script>
		function PlayGround()
		{
			var counter = 0;  //counts the number of circles created
			var circles = [ ]; //array that will hold all the circles created in the app
			var player = new Player(document.body.clientWidth/2, document.body.clientHeight/4, 50);

			//a loop that updates the circle's position on the screen
			this.loop = function(){
				for(circle in circles)
				{
					circles[circle].update(1);
				}
				player.update(1);
				collisionCheck();
			}

			this.createNewCircle = function(x,y,r){
				var new_circle = new Circle(x,y,r,counter++);
				circles.push(new_circle);
				// console.log('created a new circle!', new_circle);
			}

			function collisionCheck(){
				var dist;
				var minDist;
				var collisionOccured = false;
				for (i in circles){
					minDist = player.info.r + circles[i].info.r;
					dx = player.info.cx - circles[i].info.cx;
					dy = player.info.cy - circles[i].info.cy;
					dist = Math.sqrt(dx*dx + dy*dy);
					if(dist < minDist){
						collisionOccured = true;
						break;
					}
				}
				if(collisionOccured){
					document.dispatchEvent(gameOver);
					// if(confirm('You lost! ' + dist + " " + minDist)){
					//     window.location.reload();  
					// }
				}
			}

			//create one circle when the game starts
			this.createNewCircle(document.body.clientWidth/2, document.body.clientHeight/2, 25);
		}

		var playground = new PlayGround();

		var playLoop = setInterval(playground.loop, 15);

		var gameOver = new Event('gameOver');
		var endPlayLoop = function(){
			console.log('loop ended');
			clearInterval(playLoop);
		}
		document.addEventListener('gameOver',endPlayLoop)

		var mousedown_time;

		function getTime(){
			var date = new Date();
			return date.getTime();
		}

		document.onmousedown = function(e){
			mousedown_time = getTime();
		}
		document.onmouseup = function(e){
			time_pressed = getTime() - mousedown_time;
			// console.log('You held your mouse down for', time_pressed, 'miliseconds.');
			r = time_pressed * 50 / 1000;
			if(r > 50) r = 50;
			playground.createNewCircle(e.x,e.y,r);
		}
	</script>

</body>
</html>